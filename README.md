# goit-de-hw-07. Apache Airflow

## –ó–∞–≤–¥–∞–Ω–Ω—è

**–†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ DAG —ñ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –≤–∏–≤—á–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ–≤–Ω–∏–π –ø–µ—Ä–µ–ª—ñ–∫ –ø—Ä–∏–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å**.

**–ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**

–ù–∞–ø–∏—à—ñ—Ç—å DAG, —â–æ –º–∞—î —Ç–∞–∫—ñ –∑–∞–≤–¥–∞–Ω–Ω—è (–∫–æ–∂–µ–Ω –ø—É–Ω–∫—Ç ‚Üí –æ–¥–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è/task):  
![graph](md.media/t1.png)

1. –°—Ç–≤–æ—Ä—é—î —Ç–∞–±–ª–∏—Ü—é.

   üëâüèª –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ IF NOT EXISTS –∑ –ø–æ–ª—è–º–∏ id (–∞–≤—Ç–æ—ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç, –≥–æ–ª–æ–≤–Ω–∏–π –∫–ª—é—á), medal_type, count, created_at.

2. –í–∏–ø–∞–¥–∫–æ–≤–æ –æ–±–∏—Ä–∞—î –æ–¥–Ω–µ —ñ–∑ —Ç—Ä—å–æ—Ö –∑–Ω–∞—á–µ–Ω—å ['`Bronze`', '`Silver`', '`Gold`'].

3. –ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –æ–±—Ä–∞–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ø—É—Å–∫–∞—î –æ–¥–Ω–µ —ñ–∑ —Ç—Ä—å–æ—Ö –∑–∞–≤–¥–∞–Ω—å (—Ä–æ–∑–≥–∞–ª—É–∂–µ–Ω–Ω—è).

4. –û–ø–∏—Å —Ç—Ä—å–æ—Ö –∑–∞–≤–¥–∞–Ω—å:

1) –ó–∞–≤–¥–∞–Ω–Ω—è —Ä–∞—Ö—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ `olympic_dataset.athlete_event_results`, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–∞–ø–∏—Å `Bronze` —É –ø–æ–ª—ñ `medal`, —Ç–∞ –∑–∞–ø–∏—Å—É—î –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—é, —Å—Ç–≤–æ—Ä–µ–Ω—É –≤ –ø—É–Ω–∫—Ç—ñ 1, —Ä–∞–∑–æ–º —ñ–∑ —Ç–∏–ø–æ–º –º–µ–¥–∞–ª—ñ —Ç–∞ —á–∞—Å–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É.

2) –ó–∞–≤–¥–∞–Ω–Ω—è —Ä–∞—Ö—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ `olympic_dataset.athlete_event_results`, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–∞–ø–∏—Å `Silver` —É –ø–æ–ª—ñ `medal`, —Ç–∞ –∑–∞–ø–∏—Å—É—î –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—é, —Å—Ç–≤–æ—Ä–µ–Ω—É –≤ –ø—É–Ω–∫—Ç—ñ 1, —Ä–∞–∑–æ–º —ñ–∑ —Ç–∏–ø–æ–º –º–µ–¥–∞–ª—ñ —Ç–∞ —á–∞—Å–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É.

3) –ó–∞–≤–¥–∞–Ω–Ω—è —Ä–∞—Ö—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —É —Ç–∞–±–ª–∏—Ü—ñ `olympic_dataset.athlete_event_results`, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–∞–ø–∏—Å `Gold` —É –ø–æ–ª—ñ `medal`, —Ç–∞ –∑–∞–ø–∏—Å—É—î –æ—Ç—Ä–∏–º–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—é, —Å—Ç–≤–æ—Ä–µ–Ω—É –≤ –ø—É–Ω–∫—Ç—ñ 1, —Ä–∞–∑–æ–º —ñ–∑ —Ç–∏–ø–æ–º –º–µ–¥–∞–ª—ñ —Ç–∞ —á–∞—Å–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É.

5. –ó–∞–ø—É—Å–∫–∞—î –∑–∞—Ç—Ä–∏–º–∫—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è.

   üëâüèª –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ PythonOperaor —ñ–∑ —Ñ—É–Ω–∫—Ü—ñ—î—é time.sleep(n), —è–∫—â–æ –æ–¥–Ω–µ –∑ —Ç—Ä—å–æ—Ö –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–∞–≤–¥–∞–Ω—å –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ.

6. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–µ–Ω—Å–æ—Ä–∞, —á–∏ –Ω–∞–π–Ω–æ–≤—ñ—à–∏–π –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—ñ, —Å—Ç–≤–æ—Ä–µ–Ω—ñ–π –Ω–∞ –µ—Ç–∞–ø—ñ 1, –Ω–µ —Å—Ç–∞—Ä—à–∏–π –∑–∞ 30 —Å–µ–∫—É–Ω–¥ (–ø–æ—Ä—ñ–≤–Ω—é—é—á–∏ –∑ –ø–æ—Ç–æ—á–Ω–∏–º —á–∞—Å–æ–º). –Ü–¥–µ—è –≤ —Ç–æ–º—É, —â–æ–± —É–ø–µ–≤–Ω–∏—Ç–∏—Å—è, —á–∏ —Å–ø—Ä–∞–≤–¥—ñ –≤—ñ–¥–±—É–≤—Å—è –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—é.

   üëâüèª –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∑–∞–¥–∞—á—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ –Ω–∞ –µ—Ç–∞–ø—ñ 5 –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫—É 35 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± —É–ø–µ–≤–Ω–∏—Ç–∏—Å—è, —â–æ —Å–µ–Ω—Å–æ—Ä —Å–ø—Ä–∞–≤–¥—ñ ¬´–ø–∞–¥–∞—î¬ª, —è–∫—â–æ –∑–∞—Ç—Ä–∏–º–∫–∞ –±—ñ–ª—å—à–∞ –∑–∞ 30 —Å–µ–∫—É–Ω–¥.

## –†—ñ—à–µ–Ω–Ω—è

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è Docker:  
[Initializing Environment](https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html#initializing-environment)

–ö–æ–¥ DAG [preart_dag.py](dags/preart_dag.py)

–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—É —É Airflow UI:
![graph](md.media/p1_graph.png)

–°–∫—Ä–∏–Ω Airflow UI —ñ–∑ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—î—é —Å—Ç–∞—Ç—É—Å—ñ–≤:

- `success` (–∑–∞—Ç—Ä–∏–º–∫–∞ <= –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–≥–æ —á–∞—Å—É –≤ SQL-—Å–µ–Ω—Å–æ—Ä—ñ)
- `failed` (–∑–∞—Ç—Ä–∏–º–∫–∞ > –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–≥–æ —á–∞—Å—É –≤ SQL-—Å–µ–Ω—Å–æ—Ä—ñ)

![grid](md.media/p2_grid.png)

–°–∫—Ä–∏–Ω —Ç–∞–±–ª–∏—Ü—ñ `preart_dag_results` —ñ–∑ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:  
![—Ç–∞–±–ª–∏—Ü—è –ë–î](md.media/p3_db_table.png)
